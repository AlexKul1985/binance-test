var T=Object.defineProperty;var H=(s,t,e)=>t in s?T(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var p=(s,t,e)=>(H(s,typeof t!="symbol"?t+"":t,e),e);import{d as S,p as x,m as B,a as F,b as E,c as V,g as w,e as q,u as P,f as $,h as u,i as M,j as N,o as c,k as h,w as Q,l as a,n as g,r as D,F as I,V as U,q as A,t as _,s as m,_ as f,v as k,x as j}from"./index-2jue9A8m.js";import{u as R,a as W,V as J}from"./use-log-list-T-Mejotq.js";const y="CLOSE_FROM_CLIENT";class z{constructor(t){p(this,"socket",null);p(this,"closeHandler",null);this.socket=new WebSocket(t)}closeConnection(){var t,e;(t=this.socket)==null||t.close(),(e=this.closeHandler)==null||e.call(this,{reason:y})}setHandlerOnMessage(t){var e;t&&((e=this.socket)==null||e.addEventListener("message",t))}setHandlerOnError(t){var e;t&&((e=this.socket)==null||e.addEventListener("error",t))}setHandlerOnClose(t){var e;t&&(this.closeHandler=t,(e=this.socket)==null||e.addEventListener("close",t))}unsetHandlerOnMessage(t){var e;t&&((e=this.socket)==null||e.removeEventListener("message",t))}unsetHandlerOnError(t){var e;t&&((e=this.socket)==null||e.removeEventListener("error",t))}unsetHandlerOnClose(t){var e;t&&((e=this.socket)==null||e.removeEventListener("close",t))}setHandlerOnOpenConnection(t){var e;t&&((e=this.socket)==null||e.addEventListener("open",t))}unsetHandlerOnOpenConnection(t){var e;t&&((e=this.socket)==null||e.removeEventListener("open",t))}}async function G(s){return await(await fetch(`https://api.binance.com/api/v3/depth?symbol=${s.symbol}&limit=${s.limit}`)).json()}const K={async subscribe(s,t){await G(s);const e=new z(`wss://stream.binance.com:9443/ws/${s.symbol.toLowerCase()}@depth`);return e.setHandlerOnMessage(t.messageHandler),e.setHandlerOnClose(t.closeHandler),e.setHandlerOnError(t.errorHandler),e.setHandlerOnOpenConnection(t.openHandler),()=>{e.unsetHandlerOnClose(t.closeHandler),e.unsetHandlerOnError(t.errorHandler),e.unsetHandlerOnMessage(t.messageHandler),e.unsetHandlerOnOpenConnection(t.openHandler),e.closeConnection()}}},X=[100,500,1e3];var d=(s=>(s.Pending="Pending",s.Init="Init",s.Success="Success",s))(d||{});const C=S("order-book",{state:()=>({asks:{data:[]},bids:{data:[]},limit:1e3,requestStatus:d.Init}),actions:{updateLimit(s){this.limit=s},subscribeToMarketOrderUpdates(s,t=e=>{}){return this.requestStatus=d.Pending,K.subscribe({symbol:s,limit:this.limit},{messageHandler:e=>{if(e!=null&&e.data){const o=JSON.parse(e.data),{a:r,b:i}=o;this.asks.data=r,this.bids.data=i}},closeHandler:e=>{this.requestStatus=d.Init,this.bids.data=[],this.asks.data=[],t(e)},openHandler:()=>{this.requestStatus=d.Success}})}}}),Y=x({fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...B(),...F(),...E(),...V()},"VTable"),Z=w()({name:"VTable",props:Y(),setup(s,t){let{slots:e,emit:o}=t;const{themeClasses:r}=q(s),{densityClasses:i}=P(s);return $(()=>u(s.tag,{class:["v-table",{"v-table--fixed-height":!!s.height,"v-table--fixed-header":s.fixedHeader,"v-table--fixed-footer":s.fixedFooter,"v-table--has-top":!!e.top,"v-table--has-bottom":!!e.bottom,"v-table--hover":s.hover},r.value,i.value,s.class],style:s.style},{default:()=>{var n,l,b;return[(n=e.top)==null?void 0:n.call(e),e.default?u("div",{class:"v-table__wrapper",style:{height:M(s.height)}},[u("table",null,[e.default()])]):(l=e.wrapper)==null?void 0:l.call(e),(b=e.bottom)==null?void 0:b.call(e)]}})),{}}}),ee=a("thead",null,[a("tr",null,[a("th",{class:"text-left"}," Price "),a("th",{class:"text-left th-quantity"}," Quantity "),a("th",{class:"text-left"}," Total ")])],-1),te={class:"td-quantity"},L=N({__name:"table",props:{list:{type:Array},isLoading:{type:Boolean,default:!1}},setup(s){return(t,e)=>(c(),h(Z,{class:"table","fixed-header":!0},{default:Q(()=>[ee,a("tbody",null,[(c(!0),g(I,null,D(s.list,o=>(c(),g("tr",{key:o.key},[a("td",null,_(o.price),1),a("td",te,_(o.quantity),1),a("td",null,_(o.total),1)]))),128))]),s.isLoading?(c(),h(U,{key:0,class:"loader",color:"primary",indeterminate:""})):A("",!0)]),_:1}))}}),O=s=>s.map((t,e)=>{const o=parseFloat(t[0]),r=parseFloat(t[1]),i=o*r;return{key:String(Date.now()*(e+1)),price:o.toFixed(2),quantity:r.toFixed(2),total:i.toFixed(2)}}),v=s=>(s.sort((t,e)=>e.total-t.total),s),se={components:{CustomTable:L},setup(){const s=C();return{isLoading:m(()=>s.requestStatus===d.Pending),asksList:m(()=>v(O(s.asks.data)))}}};function oe(s,t,e,o,r,i){const n=k("CustomTable");return c(),h(n,{list:o.asksList,"is-loading":o.isLoading},null,8,["list","is-loading"])}const ne=f(se,[["render",oe]]),ae={components:{CustomTable:L},setup(){const s=C();return{isLoading:m(()=>s.requestStatus===d.Pending),bidsList:m(()=>v(O(s.bids.data)))}}};function re(s,t,e,o,r,i){const n=k("CustomTable");return c(),h(n,{list:o.bidsList,"is-loading":o.isLoading},null,8,["list","is-loading"])}const ie=f(ae,[["render",re]]),le={components:{AsksTable:ne,BidsTable:ie},setup(){const s=R(),t=C();let e=()=>{};const o=n=>{e(),t.updateLimit(n),i()},r=m({get(){return t.limit},set(n){o(n)}}),i=()=>{t.subscribeToMarketOrderUpdates(s.selectedCurrency,n=>{if(n.reason===y){const l=W();l.restore(),l.setCurrentCurrency(s.selectedCurrency)}}).then(n=>{e=n})};return i(),j(()=>{e()}),{selectedCurrency:m(()=>s.selectedCurrency),onChangeFilterQuantity:o,limitValue:r,QuantityList:X}}},ce={class:"order-book"},de={class:"order-book__filter-quantity filter-quantity"},ue=a("h2",{class:"order-book__title"},"Filter Quantity",-1),me={class:"order-book__content"},_e={class:"order-book__item"},be={class:"order-book__title order-book__title--table-title"},he={class:"order-book__item"},ke={class:"order-book__title order-book__title--table-title"};function pe(s,t,e,o,r,i){const n=k("AsksTable"),l=k("BidsTable");return c(),g("div",ce,[a("div",de,[ue,u(J,{class:"filter-quantity__select",label:"Quantity",items:o.QuantityList,variant:"outlined",modelValue:o.limitValue,"onUpdate:modelValue":t[0]||(t[0]=b=>o.limitValue=b),onChange:o.onChangeFilterQuantity},null,8,["items","modelValue","onChange"])]),a("div",me,[a("div",_e,[a("h2",be,"Asks ("+_(o.selectedCurrency)+")",1),u(n,{class:"order-book__table"})]),a("div",he,[a("h2",ke,"Bids ("+_(o.selectedCurrency)+")",1),u(l,{class:"order-book__table"})])])])}const ye=f(le,[["render",pe]]);export{ye as default};
